name: Build iOS App

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install Cordova
      run: |
        npm install -g cordova
        cordova --version
    
    - name: Install iOS platform
      run: cordova platform add ios
    
    - name: Build iOS app
      run: |
        cordova build ios --device --release
    
    - name: List build outputs
      run: |
        echo "Build completed. Looking for outputs..."
        find platforms/ios/build -name "*.app" -o -name "*.ipa" || echo "No .app or .ipa files found yet"
        ls -la platforms/ios/build/ || echo "Build directory not found"
    
    - name: Upload iOS App
      uses: actions/upload-artifact@v3
      with:
        name: mqtt-control-ios-app
        path: |
          platforms/ios/build/device/*.app
          platforms/ios/build/device/*.ipa
        if-no-files-found: warn
    
    - name: Upload Xcode Project
      uses: actions/upload-artifact@v3
      with:
        name: xcode-project
        path: platforms/ios/
        if-no-files-found: warn

    - name: Build summary
      run: |
        echo "## Build Complete! ðŸŽ‰" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Your iOS app has been built successfully." >> $GITHUB_STEP_SUMMARY
        echo "Download the artifacts to get your .app file." >> $GITHUB_STEP_SUMMARY
